% --- 基盤（日本語・フォント） ---
\usepackage{luatexja-fontspec}
\usepackage[
  haranoaji,
  jis2004,
  match,
  deluxe,
  bold,
  jfm_yoko=jlreq,
  jfm_tate=jlreqv,
]{luatexja-preset}
\usepackage{luatexja-ruby}

% --- 基本パッケージ ---
\usepackage{graphicx}
\usepackage{xcolor,luacolor}
\usepackage{multicol}

% --- 数式・理科系 ---
\usepackage{mathtools}
\usepackage{amsmath,amssymb,amsthm}
\usepackage[
  math-style=TeX,
  bold-style=ISO,
  sans-style=upright,
  warnings-off={mathtools-colon,mathtools-overbracket}
]{unicode-math}
\usepackage[per-mode=symbol]{siunitx}     % ← unicode-mathの後
\usepackage[version=4]{mhchem}
\usepackage{physics2}
\usephysicsmodule{
  ab, diagmat, xmat, bm-um.legacy, nabla.legacy, op.legacy
}
\usepackage{diffcoeff}
\usepackage{systeme}

% --- 欧文・数式フォント指定 ---
% \setmainfont{NewCM10}[
%   UprightFont={*-Regular},
%   ItalicFont={*-Italic},
%   BoldFont={*-Bold},
%   BoldItalicFont={*-BoldItalic},
% ]
% \setmathfont{NewCMMath-Regular}
% \setmathfont{NewCMMath-Regular}[range={scr,bfscr}, StylisticSet=1]

% --- 表・箇条書き ---
\usepackage{tabularray}
\usepackage{enumitem}
\usepackage{float}
\usepackage{calc}

% --- 描画・図表 ---
\usepackage{tikz}
\usepackage{pgfplots}
\usepackage{circuitikz}

% --- 装飾・枠組み ---
\usepackage{tcolorbox}
\usepackage{capt-of}
\usepackage{lua-ul}

% --- ソースコード ---
\usepackage{listings,jvlisting}
\lstset{
  basicstyle={\ttfamily},
  identifierstyle={\small},
  keywordstyle={\small\bfseries},
  ndkeywordstyle={\small},
  stringstyle={\small\ttfamily},
  commentstyle={\small\color{gray}\itshape},
  numbers=left,
  numberstyle={\scriptsize\color{gray}\ttfamily},
  stepnumber=1,
  numbersep=1em,
  tabsize=2,
  breaklines=true,
  frame={tb},
  xrightmargin=0em,
  xleftmargin=3em,
  lineskip=-0.5ex,
  columns=[l]{fullflexible},
}

% --- アルゴリズム ---
\usepackage{algorithm}
\usepackage{algorithmic}

% --- 重要語句・参考文献 ---
% \usepackage{makeidx}
% \makeindex

% --- ハイパーリンク ---
\usepackage[
  luatex,
  pdfencoding=auto,
  unicode,
  hidelinks,
  pdfusetitle
]{hyperref}   % 必ず一番最後

% --- TikZ/PGF 設定 ---
\usetikzlibrary{arrows,shapes,positioning,calc,decorations.pathmorphing,shapes.geometric,shapes.misc}
\pgfplotsset{compat=1.18}

% --- 数式・ラベル ---
\renewcommand{\labelenumii}{(\arabic{enumii}) }

% --- カスタムコマンド ---

% \emph{} を太字のサンセリフ体に変更
\renewcommand{\emph}[1]{\textbf{\textsf{#1}}}

% 太さを変えられる罫線
\newcommand{\bhline}[1]{\noalign{\hrule height #1}}
\newcommand{\bvline}[1]{\vrule width #1}

% 文献番号を上付きの「番号)」に
\makeatletter
  \renewcommand{\@biblabel}[1]{#1)}
  \renewcommand{\@cite}[2]{\textsuperscript{#1)}}
\makeatother

% 索引語
\newcommand*{\term}[2][]{%
  \highLight{#2}%
  \ifx\relax#1\relax
    \index{#2}%
  \else
    \index{#1@#2}%
  \fi
}

% キャプションの下に 6pt のスペースを追加
\setlength{\belowcaptionskip}{6pt}
