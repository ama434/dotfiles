% --- 基盤（日本語・フォント） ---
\usepackage{luatexja-fontspec}
\usepackage[
  haranoaji,
  jis2004,
  match,
  deluxe,
  bold,
  jfm_yoko=jlreq,
  jfm_tate=jlreqv,
]{luatexja-preset}
\usepackage{luatexja-ruby}

% --- 基本パッケージ ---
\usepackage{graphicx}
\usepackage{xcolor}

% --- 数式・理科系 ---
\usepackage{mathtools}
\usepackage{amsmath,amssymb,amsthm}
\usepackage[
  math-style=TeX,
  bold-style=ISO,
  sans-style=upright,
  warnings-off={mathtools-colon,mathtools-overbracket}
]{unicode-math}
\usepackage{siunitx}     % ← unicode-mathの後
\usepackage{mhchem}
\usepackage{physics2}
\usephysicsmodule{
  ab, diagmat, xmat, bm-um.legacy, nabla.legacy, op.legacy
}
\usepackage{diffcoeff}
\usepackage{systeme}

% --- 欧文・数式フォント指定 ---
\setmainfont{NewCM10}[
  UprightFont={*-Regular},
  ItalicFont={*-Italic},
  BoldFont={*-Bold},
  BoldItalicFont={*-BoldItalic},
]
\setmathfont{NewCMMath-Regular}
\setmathfont{NewCMMath-Regular}[range={scr,bfscr}, StylisticSet=1]

% --- 表・箇条書き ---
\usepackage{tabularray}
\usepackage{enumitem}
\usepackage{float}
\usepackage{calc}

% --- 描画・図表 ---
\usepackage{tikz}
\usepackage{pgfplots}
\usepackage{circuitikz}

% --- 装飾・枠組み ---
\usepackage{tcolorbox}
\usepackage{capt-of}
\usepackage{lua-ul}

% --- アルゴリズム ---
\usepackage{algorithm}
\usepackage{algorithmic}

% --- ハイパーリンク ---
\usepackage[
  luatex,
  pdfencoding=auto,
  unicode,
  hidelinks,
  pdfusetitle
]{hyperref}   % 必ず一番最後

% --- TikZ/PGF 設定 ---
\usetikzlibrary{arrows,shapes,positioning,calc,decorations.pathmorphing,shapes.geometric,shapes.misc}
\pgfplotsset{compat=1.18}

% --- 数式・ラベル ---
\renewcommand{\labelenumii}{(\arabic{enumii}) }

% --- カスタムコマンド ---
\renewcommand{\emph}[1]{\textbf{\textsf{#1}}}
\newcommand{\bhline}[1]{\noalign{\hrule height #1}}
\newcommand{\bvline}[1]{\vrule width #1}
\makeatletter
  \renewcommand{\@biblabel}[1]{#1)}
  \renewcommand{\@cite}[2]{\textsuperscript{#1)}}
\makeatother

\setlength{\belowcaptionskip}{6pt}
